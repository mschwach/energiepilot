<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EnergiePilot ‚Äì MVP</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; padding: 2rem; background: #f7fafc; }
    .wrap { max-width: 900px; margin: 0 auto; background: #fff; padding: 2rem; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.06); }
    h1 { margin-top: 0; }
    fieldset { border: 1px solid #e2e8f0; border-radius: 12px; margin-bottom: 1rem; }
    legend { padding: 0 .5rem; font-weight: 700; color: #2d3748; }
    label { display: block; margin: .35rem 0 .15rem; font-size: .95rem; color: #2d3748; }
    input, select { width: 100%; padding: .6rem .7rem; border: 1px solid #cbd5e0; border-radius: 10px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    .btn { background: #2563eb; border: none; color: #fff; padding: .8rem 1.1rem; border-radius: 10px; cursor: pointer; font-weight: 700; }
    .btn:disabled { background: #94a3b8; cursor: not-allowed; }
    pre { background: #0b1021; color: #e2e8f0; padding: 1rem; border-radius: 12px; overflow: auto; }
    .hint { color: #475569; font-size: .9rem; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üöÄ EnergiePilot ‚Äì F√∂rder-Check (MVP)</h1>
    <p class="hint">Gib ein paar Basisdaten ein. Wir pr√ºfen KfW/BAFA-Programme und berechnen den vorl√§ufigen Zuschuss-Prozentsatz (MVP-Logik).</p>

    <form id="ep-form">
      <fieldset>
        <legend>Objekt & Nutzung</legend>
        <div class="row">
          <label>Wohngeb√§ude?
            <select name="is_residential">
              <option value="true">Ja</option>
              <option value="false">Nein</option>
            </select>
          </label>
          <label>Bestandsgeb√§ude?
            <select name="building_is_bestand">
              <option value="true">Ja</option>
              <option value="false">Nein</option>
            </select>
          </label>
        </div>
        <div class="row">
          <label>Geb√§udealter (Jahre)
            <input type="number" name="building_age_years" value="20" min="0" />
          </label>
          <label>Selbstnutzung?
            <select name="self_use">
              <option value="true">Ja</option>
              <option value="false">Nein</option>
            </select>
          </label>
        </div>
      </fieldset>

      <fieldset>
        <legend>Haushalt & Einkommen</legend>
        <div class="row">
          <label>Zu versteuerndes Einkommen (‚Ç¨)
            <input type="number" name="income_zu_verst_eur" value="38000" />
          </label>
          <label>Kind(er) unter 18?
            <select name="has_child_under_18">
              <option value="true">Ja</option>
              <option value="false">Nein</option>
            </select>
          </label>
        </div>
      </fieldset>

      <fieldset>
        <legend>Heizung / Ma√ünahme</legend>
        <div class="row">
          <label>Altanlage √ñl/Gas?
            <select name="old_oil_or_old_gas">
              <option value="true">Ja</option>
              <option value="false">Nein</option>
            </select>
          </label>
          <label>iSFP vorhanden?
            <select name="has_isfp">
              <option value="true">Ja</option>
              <option value="false">Nein</option>
            </select>
          </label>
        </div>
        <div class="row">
          <label>Geplante Ma√ünahme
            <select name="measure_selected">
              <option value="Heizungstausch_WP">Heizungstausch ‚Äì W√§rmepumpe</option>
              <option value="Solarthermieanlage">Solarthermie</option>
              <option value="D√§mmung">Geb√§udeh√ºlle ‚Äì D√§mmung</option>
              <option value="MSR">Anlagentechnik ‚Äì MSR/L√ºftung</option>
            </select>
          </label>
          <label>WP-Quelle (falls WP)
            <select name="wp_quelle">
              <option value="luft">Luft</option>
              <option value="sole">Sole</option>
              <option value="wasser">Wasser</option>
            </select>
          </label>
        </div>
        <div class="row">
          <label>WP Effizienz (JAZ/Œ∑s, grober Wert)
            <input type="number" name="wp_jahresarbeitszahl_oder_eta" step="0.1" value="3.5" />
          </label>
          <label>WP-Effizienzbonus-Kriterien erf√ºllt?
            <select name="hp_effizienzbonus_criteria_met">
              <option value="true">Ja</option>
              <option value="false">Nein</option>
            </select>
          </label>
        </div>
      </fieldset>

      <fieldset>
        <legend>Effizienzhaus (optional)</legend>
        <div class="row">
          <label>Ziel-EH-Klasse
            <select name="target_eh_class">
              <option value="">‚Äì</option>
              <option value="EH85">EH85</option>
              <option value="EH70">EH70</option>
              <option value="EH55">EH55</option>
              <option value="EH40">EH40</option>
              <option value="EH_Denkmal">EH Denkmal</option>
            </select>
          </label>
          <label>EE-Klasse nutzen?
            <select name="use_ee_class">
              <option value="false">Nein</option>
              <option value="true">Ja</option>
            </select>
          </label>
        </div>
        <div class="row">
          <label>Eigentum heute vorhanden?
            <select name="owns_residential_property_today">
              <option value="false">Nein</option>
              <option value="true">Ja</option>
            </select>
          </label>
          <label>Energieklasse beim Kauf (f√ºr KfW 308)
            <select name="energy_class_at_purchase">
              <option value="">‚Äì</option>
              <option value="F">F</option>
              <option value="G">G</option>
              <option value="H">H</option>
            </select>
          </label>
        </div>
      </fieldset>

      <button class="btn" type="submit">F√∂rder-Check starten</button>
    </form>

    <h2>Ergebnis</h2>
    <pre id="out">Noch keine Anfrage gesendet‚Ä¶</pre>
  </div>

  <script>
    const form = document.getElementById('ep-form');
    const out = document.getElementById('out');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const fd = new FormData(form);
      const payload = {};
      for (const [k,v] of fd.entries()) {
        if (v === 'true') payload[k] = true;
        else if (v === 'false') payload[k] = false;
        else if (!isNaN(v) && v.trim() !== '') payload[k] = Number(v);
        else payload[k] = v;
      }
      out.textContent = 'Bitte warten‚Ä¶';
      try {
        const r = await fetch('/.netlify/functions/analyse', {
          method: 'POST',
          headers: { 'content-type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const data = await r.json();
        out.textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        out.textContent = 'Fehler: ' + err.message;
      }
    });
  </script>
</body>
</html>